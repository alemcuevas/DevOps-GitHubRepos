## ğŸ“¦ 4.4 Uso de plantillas de despliegue

En proyectos mÃ¡s complejos, donde mÃºltiples aplicaciones o microservicios comparten patrones similares de despliegue, el uso de **plantillas (templates)** en Azure Pipelines permite **reutilizar y estandarizar configuraciones de CI/CD**. Esto reduce la duplicaciÃ³n, mejora la mantenibilidad y asegura consistencia entre equipos.

---

### ğŸ§  Â¿QuÃ© es una plantilla de despliegue?

Una **plantilla de YAML** en Azure Pipelines es un archivo `.yml` externo que contiene una definiciÃ³n reutilizable de uno o mÃ¡s elementos de un pipeline. Puede ser utilizada para definir:

- Pasos de despliegue (a Azure App Service, AKS, VMs, etc.)
- Bloques de lÃ³gica compartida entre pipelines
- Variables comunes
- Validaciones o tareas personalizadas

---

### ğŸ§© Tipos de plantillas

1. **Plantillas de pasos (steps)**  
   Definen una secuencia especÃ­fica de tareas que puede insertarse en cualquier pipeline.

2. **Plantillas de trabajos (jobs)**  
   Agrupan tareas dentro de un job reutilizable.

3. **Plantillas de etapas (stages)**  
   Se usan para definir etapas completas de un pipeline, como `build`, `test`, o `deploy`.

4. **Plantillas de variables**  
   Permiten centralizar valores compartidos como rutas, tokens o configuraciones por ambiente.

---

### ğŸ“ OrganizaciÃ³n recomendada

Se recomienda crear una carpeta `templates/` dentro del repositorio y almacenar allÃ­ las plantillas reutilizables, por ejemplo:

- templates/deploy-app-service.yml  
- templates/stage-deploy.yml  
- templates/variables-dev.yml

---

### ğŸ› ï¸ Ejemplo de estructura modular

- `azure-pipelines.yml` (pipeline principal):  
  Incluye plantillas usando `template: ./templates/deploy-app-service.yml`

- `templates/deploy-app-service.yml`:  
  Contiene los pasos necesarios para hacer deploy a App Service  
  - Ejemplo de pasos: login a Azure, selecciÃ³n de subscription, uso de WebApp

- `templates/variables-dev.yml`:  
  Variables:  
  - environment: dev  
  - resourceGroup: rg-dev  
  - webAppName: app-banca-dev

---

### âœ… Ventajas de usar plantillas

- Reduce errores humanos al evitar copiar y pegar pipelines largos
- Facilita mantener estÃ¡ndares de seguridad, naming y flujos
- Hace el mantenimiento mÃ¡s eficiente cuando se modifica una lÃ³gica comÃºn
- Permite escalar CI/CD en equipos grandes o con mÃºltiples servicios

---

### ğŸ“Œ Buenas prÃ¡cticas

- Divide las plantillas por etapa lÃ³gica (`build`, `deploy`, `qa`, `post-deploy`)
- Usa `parameters:` en las plantillas para hacerlas flexibles y configurables
- Versiona tus plantillas como si fueran cÃ³digo: con revisiÃ³n, testing y release
- Documenta el uso de cada plantilla para facilitar su adopciÃ³n

---

### ğŸ“š Recursos adicionales

- [DocumentaciÃ³n oficial de plantillas YAML](https://learn.microsoft.com/en-us/azure/devops/pipelines/process/templates)  
- [ParÃ¡metros en plantillas](https://learn.microsoft.com/en-us/azure/devops/pipelines/process/templates#parameters)  
- [Ejemplos de uso de templates reutilizables](https://learn.microsoft.com/en-us/azure/devops/pipelines/process/templates?tabs=yaml)

