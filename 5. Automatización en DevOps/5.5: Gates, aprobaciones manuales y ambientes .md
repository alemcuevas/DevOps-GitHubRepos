## ğŸ” 5.5 Gates, aprobaciones manuales y ambientes

Azure Pipelines permite controlar el flujo de despliegue mediante **aprobaciones manuales**, **gates (puertas automÃ¡ticas)** y la configuraciÃ³n explÃ­cita de **ambientes**, garantizando que las etapas crÃ­ticas como QA o producciÃ³n no se ejecuten sin verificaciÃ³n o sin condiciones previas cumplidas.

---

### ğŸŒ Â¿QuÃ© es un ambiente (environment)?

Un **ambiente** en Azure DevOps representa un entorno lÃ³gico o fÃ­sico donde se ejecuta el despliegue:  
- Desarrollo (`dev`)  
- Pruebas (`qa`)  
- Pre-producciÃ³n (`staging`)  
- ProducciÃ³n (`prod`)  

Cada ambiente puede tener:
- Reglas de seguridad especÃ­ficas
- Historial de despliegues
- PolÃ­ticas de aprobaciÃ³n y validaciÃ³n
- Variables o configuraciones exclusivas

---

### ğŸ‘¥ Â¿QuÃ© son las aprobaciones manuales?

Las **aprobaciones manuales** permiten detener una ejecuciÃ³n hasta que uno o mÃ¡s usuarios autoricen continuar. Se utilizan comÃºnmente antes de entornos sensibles como `production` o `clientes externos`.

#### CaracterÃ­sticas:
- Se asignan a uno o varios usuarios o grupos
- Permiten mensajes personalizados
- Se puede configurar tiempo de espera (timeout)
- Se registra quiÃ©n aprobÃ³ o rechazÃ³

---

### ğŸš¦ Â¿QuÃ© son los gates?

Los **gates** son validaciones automÃ¡ticas que deben completarse antes de avanzar. Permiten conectar condiciones externas al flujo CI/CD.

#### Ejemplos comunes:
- Llamar a una API y verificar un resultado
- Esperar una duraciÃ³n especÃ­fica (delay controlado)
- Validar cobertura de cÃ³digo mÃ­nima
- Consultar estado de seguridad o calidad

---

### ğŸ” Flujo tÃ­pico con ambientes y control

1. La etapa de `deploy-qa` se ejecuta automÃ¡ticamente
2. La etapa `deploy-prod` estÃ¡ asociada al ambiente `production`
3. Antes de iniciar:
   - Se ejecutan gates: por ejemplo, verificar reporte de seguridad
   - Se espera aprobaciÃ³n manual de un responsable
4. Si ambos se cumplen, continÃºa el despliegue

---

### âœ… Buenas prÃ¡cticas

- Asigna ambientes explÃ­citos a cada etapa de despliegue
- Usa aprobaciones solo donde realmente agreguen valor
- Documenta quiÃ©n aprueba y bajo quÃ© criterios
- Usa grupos de seguridad en lugar de usuarios individuales
- Configura gates para validar estado de dependencias externas (monitoring, auditorÃ­a, etc.)
- Centraliza la configuraciÃ³n de ambientes para facilitar auditorÃ­a y monitoreo

---

### ğŸ“š Recursos adicionales

- [Ambientes en Azure Pipelines](https://learn.microsoft.com/en-us/azure/devops/pipelines/process/environments)  
- [Aprobaciones y checks](https://learn.microsoft.com/en-us/azure/devops/pipelines/process/approvals)  
- [Configurar gates en un entorno](https://learn.microsoft.com/en-us/azure/devops/pipelines/release/approvals/gates)
