## ğŸ§© 5.4 Variables, templates y multi-stage pipelines

Azure Pipelines permite crear flujos de CI/CD altamente personalizables y mantenibles usando tres herramientas clave: **variables**, **plantillas (templates)** y **pipelines multi-stage**. Estos elementos te permiten escalar y organizar tus definiciones de forma modular, segura y eficiente.

---

### ğŸ”‘ Variables en Azure Pipelines

Las **variables** son valores reutilizables que pueden definirse de forma global, por etapa o por entorno.

#### Tipos comunes:

- **Variables definidas por el usuario**:  
  Se declaran directamente en el YAML o desde la interfaz.

- **Variables predefinidas**:  
  Azure DevOps genera variables automÃ¡ticamente como:
  - `Build.BuildId`
  - `Agent.OS`
  - `System.PullRequest.SourceBranch`

- **Variables de grupo**:  
  Permiten reutilizar conjuntos de variables seguras entre pipelines (ideal para tokens, claves o rutas).

#### Buenas prÃ¡cticas:

- Usar variables para valores como nombres de recursos, rutas, entornos (`dev`, `qa`, `prod`).
- Proteger las variables sensibles con la opciÃ³n de `secreto`.
- Versionar variables complejas desde archivos `.yml` dedicados.

---

### ğŸ§± Templates en YAML

Las **plantillas** permiten extraer partes repetitivas del pipeline (steps, jobs, stages, variables) a archivos externos reutilizables.

#### Tipos:

- `steps:` â€“ una secuencia de tareas (build, install, deploy)
- `jobs:` â€“ una unidad de ejecuciÃ³n
- `stages:` â€“ una agrupaciÃ³n lÃ³gica de procesos
- `variables:` â€“ un conjunto de definiciones dinÃ¡micas

#### Ventajas:

- Centraliza la lÃ³gica comÃºn entre proyectos
- Mejora el mantenimiento del pipeline
- Permite parametrizaciÃ³n y condiciones dinÃ¡micas

---

### ğŸš¦ Multi-stage Pipelines

Permiten dividir el proceso en **etapas secuenciales o paralelas**, cada una con sus propias tareas, condiciones y entornos.

#### Ejemplo de etapas tÃ­picas:

- `Build`: compila, instala dependencias, ejecuta pruebas
- `Test`: pruebas funcionales, de seguridad, carga
- `Deploy Dev`: despliegue automÃ¡tico a entorno de desarrollo
- `Deploy QA`: requiere aprobaciÃ³n manual
- `Deploy Prod`: aprobaciÃ³n + verificaciÃ³n externa (gates)

#### Ventajas:

- Mejor control del flujo de CI/CD
- SeparaciÃ³n clara de responsabilidades
- FÃ¡cil visualizaciÃ³n en el portal DevOps

---

### âœ… Recomendaciones generales

- Usa plantillas cuando tu pipeline supere las 40â€“50 lÃ­neas
- Aplica variables en nombres de recursos para evitar duplicaciÃ³n
- Organiza tus plantillas por tipo: `steps/`, `jobs/`, `stages/`, `vars/`
- Versiona tus plantillas igual que el cÃ³digo fuente
- Documenta los parÃ¡metros requeridos por cada plantilla

---

### ğŸ“š Recursos adicionales

- [Variables en Azure Pipelines](https://learn.microsoft.com/en-us/azure/devops/pipelines/process/variables)  
- [Plantillas YAML reutilizables](https://learn.microsoft.com/en-us/azure/devops/pipelines/process/templates)  
- [Multi-stage Pipelines](https://learn.microsoft.com/en-us/azure/devops/pipelines/process/stages)
